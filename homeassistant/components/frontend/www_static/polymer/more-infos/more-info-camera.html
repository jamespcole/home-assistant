<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<polymer-element name="more-info-camera" attributes="stateObj">
<template>
  <style>

  #retry_btn {
    color: #4285f4;
  }
   @media (max-width: 720px) {
      :host .camera-image {
        max-width: calc(100%);
      }
    }

    @media (max-width: 620px) {
      :host .camera-image {
        max-width: calc(100%);
      }
    }

    @media (max-height: 780px) {
      :host .camera-container {
        height: 550px;
      }
    }

  </style>
  <div class="camera-container" id="camera_container">
    <template if="{{ connectionFailed }}">
      <div center vertical layout>
        <div>Could not connect to camera...</div>
        <paper-button ink id="retry_btn" on-click="{{retry}}">Retry</paper-button>
      <div>
    </template>

    <img  hidden?="{{connectionFailed}}" src="" onload="" id="camera_image" class="camera-image" />
    <div center horizontal layout>
      <div>

      </div>
      <div flex>
        &nbsp;
      </div>
      <div>
        {{stateObj.attributes['brand']}} - {{stateObj.attributes['model_name']}}
      </div>
    </div>
  </div>


</template>
<script>

  var authStore = window.hass.authStore;

  Polymer({
    stateObj: null,
    isStreaming: false,
    stillImage: null,
    reloadTime: null,
    dialogOpen: false,
    errorCount: 0,
    connectionFailed: false,

    //document.querySelector("* /deep/ more-info-dialog").reposition(null, Date.now());

    dialogOpenChanged: function(oldVal, newVal) {
      if(newVal == true) {
        this.startImageStream();
      }
      else {
        this.$.camera_image.src = this.stateObj.attributes['still_image_url'] + '?api_password=' + authStore.authToken + '&t=' + Date.now();
      }
    },

    startImageStream: function() {
      this.$.camera_image.src = this.stateObj.attributes['stream_url'] + '?api_password=' + authStore.authToken;
    },

    retry: function(event, detail, sender) {
      this.startImageStream();
    }

  });
</script>
</polymer-element>
